"use strict";$(document).ready((function(){let $searchInput,$container,$loader,$dropdown,$templateInput,searchTimeout,isLoading=!1,currentSearch="",currentXhr=null,baseUrl="";function init(){$searchInput=$("#template-search-input"),$container=$("#template-list-container"),$loader=$("#template-search-loader"),$templateInput=$("#template"),0!==$searchInput.length&&0!==$container.length&&($dropdown=$container.closest(".voice-dropdown-content"),0!==$dropdown.length&&(baseUrl=$container.attr("data-base-url")||window.templateSearchConfig&&window.templateSearchConfig.baseUrl||"",baseUrl?(setupEventListeners(),setupSelectionHighlight()):console.warn("Template search base URL not found")))}function setupEventListeners(){$dropdown.on("click",(function(e){e.stopPropagation()})),$searchInput.on("click",(function(e){e.stopPropagation()})),$container.on("click",(function(e){e.stopPropagation()})),$searchInput.on("input",(function(e){clearTimeout(searchTimeout),currentXhr&&4!==currentXhr.readyState&&(currentXhr.abort(),currentXhr=null);const searchTerm=$(this).val().trim();currentSearch=searchTerm,$loader.length>0&&(searchTerm?$loader.removeClass("hidden"):$loader.addClass("hidden")),searchTimeout=setTimeout((function(){loadTemplates(searchTerm,!0)}),300)})),$container.on("scroll",(function(){if(isLoading)return;const $this=$(this),scrollTop=$this.scrollTop(),scrollHeight=$this[0].scrollHeight,clientHeight=$this.height(),nextUrl=$this.attr("data-next");scrollTop+clientHeight>=.8*scrollHeight&&nextUrl&&loadTemplates(currentSearch,!1)}));const $dropdownButton=$dropdown.closest(".relative").find(".voice-type-dropdown");$dropdownButton.length>0&&$dropdownButton.on("click",(function(){setTimeout(updateSelectedTemplate,100)}))}function setupSelectionHighlight(){$templateInput.length>0&&$templateInput.on("change",(function(){updateSelectedTemplate()}));const originalSelectTemplate=window.selectTemplate;window.selectTemplate=function(e){originalSelectTemplate&&originalSelectTemplate(e),setTimeout(updateSelectedTemplate,50),$dropdown.length>0&&$dropdown.slideUp(200)}}function updateSelectedTemplate(){if(0===$container.length||0===$templateInput.length)return;const selectedTemplateId=$templateInput.val();selectedTemplateId&&$container.find("[data-val]").each((function(){const $item=$(this);$item.attr("data-val")===selectedTemplateId?$item.addClass("bg-color-F6 dark:bg-color-3A font-medium"):$item.removeClass("bg-color-F6 dark:bg-color-3A font-medium")}))}function loadTemplates(searchTerm,reset=!1){if(isLoading)return;let url;if(currentXhr&&4!==currentXhr.readyState&&(currentXhr.abort(),currentXhr=null),isLoading=!0,reset)url=baseUrl+"?only=templates",searchTerm&&(url+="&search="+encodeURIComponent(searchTerm));else{const nextUrl=$container.attr("data-next");if(!nextUrl)return isLoading=!1,void(currentXhr=null);url=nextUrl}currentXhr=$.ajax({url:url,type:"GET",dataType:"json",headers:{"X-Requested-With":"XMLHttpRequest"},beforeSend:function(xhr){currentXhr=xhr},success:function(data){if(!currentXhr||"abort"!==currentXhr.statusText){if(reset)$container.html(data.items);else{const $tempDiv=$("<div>").html(data.items),hasItems=$tempDiv.find("[data-val]").length>0;hasItems&&$container.append(data.items)}$container.attr("data-next",data.next||""),updateSelectedTemplate()}},error:function(xhr,status,error){"abort"!==status&&console.error("Error loading templates:",error)},complete:function(){isLoading=!1,currentXhr=null,$loader.length>0&&$loader.addClass("hidden")}})}init()}));