"use strict";let phoneInput,debounceTimer,selectedSegments={};function updateSelectedSegmentsDisplay(){const e=Object.keys(selectedSegments).length,t=$("#selectSegmentText").val()||jsLang("Select Segment");if(0===e)$("#selectedSegment").text(t).removeClass("hidden"),$("#selectedSegmentsTags").addClass("hidden").empty(),$("#selectedCountBadge").addClass("hidden");else{$("#selectedSegment").addClass("hidden"),$("#selectedSegmentsTags").removeClass("hidden").empty(),$("#selectedCountBadge").addClass("hidden");const t=Object.keys(selectedSegments),n=Math.min(e,4),s=e-4;for(let e=0;e<n;e++){const n=t[e],s=selectedSegments[n],o=$("<div/>").text(s).html(),a=`\n                <span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-gradient-to-r from-blue-500 to-purple-600 dark:from-blue-600 dark:to-purple-700 text-white rounded-md text-xs font-medium shadow-sm hover:shadow-md transition-all duration-200 animate-fadeIn" style="animation-delay: ${50*e}ms">\n                    <span class="max-w-[120px] truncate">${o}</span>\n                    <button type="button" class="remove-segment-tag flex-shrink-0 hover:bg-white/20 rounded-full p-0.5 transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-white/50" data-id="${n}" onclick="removeSegment(${n})" aria-label="${jsLang("Remove")} ${o}">\n                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">\n                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>\n                        </svg>\n                    </button>\n                </span>\n            `;$("#selectedSegmentsTags").append(a)}s>0&&$("#selectedCountBadge").removeClass("hidden").text(`+${s} ${jsLang("more")}`)}}function updateSegmentIdsInput(){const e=Object.keys(selectedSegments);$("#selectedSegmentIds").val(e.join(",")),$('input[name="segment_ids[]"]').remove(),e.forEach((function(e){$("#selectedSegmentIds").after(`<input type="hidden" name="segment_ids[]" value="${e}">`)}))}function initializePhoneInput(){const e=document.querySelector("#contactPhone");if(e)try{phoneInput=window.intlTelInput(e,{preferredCountries:["us","gb","ca","au","in","bd"],separateDialCode:!0,initialCountry:"bd",utilsScript:utilsScriptLoadingPath,autoPlaceholder:"polite",nationalMode:!1}),e.addEventListener("input",(function(e){const t=e.target.value,n=t.replace(/\D/g,"");if(t!==n){const s=e.target.selectionStart,o=t.length-n.length;e.target.value=n;const a=Math.max(0,s-o);e.target.setSelectionRange(a,a)}updatePhoneData()})),e.addEventListener("paste",(function(e){e.preventDefault();const t=(e.clipboardData||window.clipboardData).getData("text").replace(/\D/g,"");if(t){const n=e.target.selectionStart,s=e.target.selectionEnd,o=e.target.value,a=o.substring(0,n)+t+o.substring(s);e.target.value=a.replace(/\D/g,""),e.target.setSelectionRange(n+t.length,n+t.length),updatePhoneData()}})),e.addEventListener("keypress",(function(e){"Backspace"!==e.key&&"Delete"!==e.key&&"Tab"!==e.key&&"Escape"!==e.key&&"Enter"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key&&"ArrowUp"!==e.key&&"ArrowDown"!==e.key&&(/^[0-9]$/.test(e.key)||e.preventDefault())})),e.addEventListener("countrychange",(function(){updatePhoneData()}))}catch(e){toastMixin.fire({icon:"error",title:jsLang("Failed to initialize phone input. Please try again.")})}}function updatePhoneData(){if(phoneInput)try{const e=phoneInput.getSelectedCountryData();let t;t=void 0!==window.intlTelInputUtils&&window.intlTelInputUtils&&window.intlTelInputUtils.numberFormat?phoneInput.getNumber(window.intlTelInputUtils.numberFormat.E164):"undefined"!=typeof intlTelInputUtils&&intlTelInputUtils&&intlTelInputUtils.numberFormat?phoneInput.getNumber(intlTelInputUtils.numberFormat.E164):phoneInput.getNumber();const n=t?t.replace("+","").replace(/\D/g,""):"",s=e.iso2.toUpperCase();$("#dialCode").val(e.dialCode),$("#countryCode").val(s),$("#fullPhone").val(n)}catch(e){toastMixin.fire({icon:"error",title:e})}}function saveContact(){if($(".error-message").addClass("hidden").text(""),$(".border-red-500").removeClass("border-red-500"),updatePhoneData(),!phoneInput)return $("#contactPhone").addClass("border-red-500"),$("#phone-error").text(jsLang("Phone input not initialized")).removeClass("hidden"),!1;let e;if(e=void 0!==window.intlTelInputUtils&&window.intlTelInputUtils&&window.intlTelInputUtils.numberFormat?phoneInput.getNumber(window.intlTelInputUtils.numberFormat.NATIONAL):"undefined"!=typeof intlTelInputUtils&&intlTelInputUtils&&intlTelInputUtils.numberFormat?phoneInput.getNumber(intlTelInputUtils.numberFormat.NATIONAL):phoneInput.getNumber(),e=e?e.replace(/\D/g,""):"",!e||e.length<5)return $("#contactPhone").addClass("border-red-500"),$("#phone-error").text("Please enter a valid phone number").removeClass("hidden"),!1;const t=Object.keys(selectedSegments),n={name:$("#contactName").val().trim(),phone:$("#fullPhone").val(),country_code:$("#countryCode").val(),segment_ids:t.length>0?t:null,_token:$('input[name="_token"]').val()};let s=!0;if(n.name||(s=!1,$("#contactName").addClass("border-red-500"),$("#name-error").text("Contact name is required").removeClass("hidden")),(!n.phone||n.phone.length<10)&&(s=!1,$("#contactPhone").addClass("border-red-500"),$("#phone-error").text("Please enter a valid phone number").removeClass("hidden")),!s)return!1;$("#saveBtnText").addClass("hidden"),$("#saveBtnLoader").removeClass("hidden"),$("#saveContactBtn").prop("disabled",!0);const o=$("#contactId").val(),a=o?updateContactUrl.replace(":id",o):storeContactUrl;"PUT"===(o?"PUT":"POST")&&(n._method="PUT"),$.ajax({url:a,method:"POST",data:n,success:function(e){e.success?(closeModal($("#modal7")),$("#contactForm")[0].reset(),$("#contactId").val(""),selectedSegments={},$(".segment-checkbox").prop("checked",!1),$("#selectedSegment").text("Select Segment"),$("#selectedSegmentIds").val(""),$("#selectedSegmentsTags").addClass("hidden").empty(),$("#selectedCountBadge").addClass("hidden"),$('input[name="segment_ids[]"]').remove(),phoneInput&&phoneInput.setNumber(""),toastMixin.fire({icon:"success",title:e.message||jsLang("Contact saved successfully")}),setTimeout((function(){"function"==typeof reloadContactsTable?reloadContactsTable():searchContacts(null)}),500)):toastMixin.fire({icon:"error",title:e.message||jsLang("Failed to save contact")})},error:function(e){const t=e.responseJSON?.errors,n=e.responseJSON?.error||e.responseJSON?.message;if(t){for(const[e,n]of Object.entries(t)){const t=$(`#${e}-error`),s=$(`[name="${e}"]`);t.length&&t.text(n[0]).removeClass("hidden"),s.length&&s.addClass("border-red-500")}const e=t.phone?.[0]||Object.values(t)[0]?.[0];e&&toastMixin.fire({icon:"error",title:e})}else toastMixin.fire({icon:"error",title:n||jsLang("An error occurred while saving the contact")})},complete:function(){$("#saveBtnText").removeClass("hidden"),$("#saveBtnLoader").addClass("hidden"),$("#saveContactBtn").prop("disabled",!1)}})}function editContact(e){$("#contactForm")[0].reset(),$(".error-message").addClass("hidden").text(""),$(".border-red-500").removeClass("border-red-500");const t=$("#modal7 .px-7");t.addClass("opacity-50 pointer-events-none"),$("#modal7 h5").text("Edit Contact"),$("#modal7 p").text("Update your existing contact information."),$.ajax({url:getContactUrl.replace(":id",e),method:"GET",success:function(e){if(e.success){const t=e.contact;if($("#contactId").val(t.id||""),$("#contactName").val(t.name||""),phoneInput&&t.phone&&t.country_code){phoneInput.setCountry(t.country_code.toLowerCase());const o=phoneInput.getSelectedCountryData(),a=o&&o.dialCode?o.dialCode:"";let i=t.phone;a&&t.phone.startsWith(a)&&(i=t.phone.substring(a.length)),phoneInput.setNumber(i)}function n(e=0){if(t.segment_ids){let s=[];if(Array.isArray(t.segment_ids))s=t.segment_ids;else if("string"==typeof t.segment_ids)try{const e=JSON.parse(t.segment_ids);s=Array.isArray(e)?e:t.segment_ids.split(",").map((e=>e.trim())).filter((e=>e))}catch(e){s=t.segment_ids.split(",").map((e=>e.trim())).filter((e=>e))}else null!==t.segment_ids&&void 0!==t.segment_ids&&(s=[t.segment_ids]);let o=!0;s.forEach((e=>{const t=String(e).trim();if(!t)return;const n=$(`.segment-checkbox[value="${t}"]`);if(n.length){const e=n.data("name")||n.closest(".segment-option").data("name")||`Segment ${t}`;selectedSegments[t]=e,n.prop("checked",!0)}else selectedSegments[t]=`Segment ${t}`,o=!1})),updateSelectedSegmentsDisplay(),updateSegmentIdsInput(),!o&&e<3&&setTimeout((()=>n(e+1)),200)}else $("#selectedSegmentIds").val(""),updateSelectedSegmentsDisplay()}$("#countryCode").val(t.country_code?t.country_code.toUpperCase():""),selectedSegments={},$(".segment-checkbox").prop("checked",!1);const s=$("#modal7");s.removeClass("hidden"),setTimeout((()=>{s.addClass("opacity-100"),s.find(".modalBox").addClass("scale-100 opacity-100"),setTimeout(n,100)}),50)}},error:function(e){toastMixin.fire({icon:"error",title:jsLang("Failed to load contact information. Please try again.")})},complete:function(){t.removeClass("opacity-50 pointer-events-none")}})}function getCsrfToken(){const e=document.querySelector('meta[name="csrf-token"]');if(e&&e.content)return e.content;const t=document.querySelector('input[name="_token"]');return t&&t.value?t.value:""}function deleteContact(e){const t=$(`#deleteModal-${e}`),n=$(`#deleteContactForm-${e}`),s=getCsrfToken();if(!n.length)return;const o=n.find('button[type="submit"]'),a=o.find(".loader"),i=o.find("span");a.removeClass("hidden"),i.addClass("opacity-0"),o.prop("disabled",!0),fetch(deleteContactUrl.replace(":id",e),{method:"POST",headers:{"X-CSRF-TOKEN":s,Accept:"application/json","X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},body:JSON.stringify({_method:"DELETE"})}).then((async e=>{if(!e.ok){let n=null;try{n=await e.json()}catch(e){}const s=n&&(n.message||n.error)||"Request failed";return toastMixin.fire({title:s,icon:"error"}),t.removeClass("opacity-100"),t.find(".modalBox").removeClass("scale-100 opacity-100"),setTimeout((()=>{t.addClass("hidden")}),300),a.addClass("hidden"),i.removeClass("opacity-0"),o.prop("disabled",!1),null}return e.json()})).then((n=>{if(null!==n){if(!n.success)throw new Error(n.message||"Failed to delete contact");$(`tr[data-contact-id="${e}"]`).remove(),t.removeClass("opacity-100"),t.find(".modalBox").removeClass("scale-100 opacity-100"),setTimeout((()=>{t.addClass("hidden")}),300),toastMixin.fire({icon:"success",title:n.message||jsLang("Contact deleted successfully")}),setTimeout((function(){"function"==typeof reloadContactsTable?reloadContactsTable():searchContacts(null)}),500)}})).catch((e=>{toastMixin.fire({icon:"error",title:e.message||jsLang("Failed to delete contact")})})).finally((()=>{a.addClass("hidden"),i.removeClass("opacity-0"),o.prop("disabled",!1)}))}function closeModal(e){"modal7"===e.attr("id")&&(selectedSegments={},$(".segment-checkbox").prop("checked",!1),$("#selectedSegmentIds").val(""),$("#selectedSegmentsTags").addClass("hidden").empty(),$("#selectedCountBadge").addClass("hidden"),$('input[name="segment_ids[]"]').remove(),updateSelectedSegmentsDisplay()),e.removeClass("opacity-100"),e.find(".modalBox").removeClass("scale-100 opacity-100"),setTimeout((()=>{e.addClass("hidden")}),300)}function searchSubscribers(e){const t=$(e).val().trim().toLowerCase(),n=SITE_URL+"/user/marketing-bot/subscribers?search="+t;clearTimeout(debounceTimer),debounceTimer=setTimeout((()=>{$.ajax({url:n,type:"GET",data:{},dataType:"json",beforeSend:function(){window.subscribersSkeleton&&"function"==typeof window.subscribersSkeleton.show?window.subscribersSkeleton.show():($(".table-skeleton").removeClass("hidden"),$(".table-content").addClass("hidden"))},success:function(e){if(e&&e.items&&String(e.items).trim().length)$(".subscriber-table.table-content").replaceWith(e.items);else{const e=`<div class="subscriber-table table-content">${subscriberEmptyHtml()}</div>`;$(".subscriber-table.table-content").replaceWith(e)}window.subscribersSkeleton&&"function"==typeof window.subscribersSkeleton.hide?window.subscribersSkeleton.hide():($(".table-skeleton").addClass("hidden"),$(".table-content").removeClass("hidden"))},error:function(e,t,n){window.subscribersSkeleton&&"function"==typeof window.subscribersSkeleton.hide?window.subscribersSkeleton.hide():($(".table-skeleton").addClass("hidden"),$(".table-content").removeClass("hidden"))}})}),1e3)}function subscriberEmptyHtml(){return`\n    <section class="rounded-xl bg-white dark:bg-color-3A border border-color-89/10 overflow-hidden">\n        <div class="overflow-x-auto">\n            <table class="min-w-full text-sm">\n                <thead class="bg-light-icon dark:bg-dark-icon text-color-14 dark:text-white">\n                    <tr>\n                        <th class="text-start font-semibold px-6 py-5 text-xs uppercase tracking-wider">${jsLang("ID")}</th>\n                        <th class="text-start font-semibold px-6 py-5 text-xs uppercase tracking-wider">${jsLang("Name")}</th>\n                        <th class="text-start font-semibold px-6 py-5 text-xs uppercase tracking-wider">${jsLang("User Name")}</th>\n                        <th class="text-end font-semibold px-6 py-5 text-xs uppercase tracking-wider">${jsLang("Actions")}</th>\n                    </tr>\n                </thead>\n                <tbody class="bg-white dark:bg-color-3A divide-y divide-light-secondary/10 dark:divide-dark-secondary/10">\n                    <tr>\n                        <td colspan="7">\n                            <svg class="mx-auto mt-10" xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 44 44" fill="none">\n                                <g clip-path="url(#clip0_2698_2638)">\n                                    <path d="M38.6467 13.4583H5.35361C4.07374 13.4583 3.03613 14.4958 3.03613 15.7757V30.9319H40.9641V15.7757C40.9641 14.4959 39.9265 13.4583 38.6467 13.4583Z" fill="#FF9A00"/>\n                                    <path d="M8.8972 0C7.26421 0 5.94043 1.32378 5.94043 2.95677V41.0432C5.94043 42.6762 7.26421 44 8.8972 44H35.1026C36.7356 44 38.0594 42.6762 38.0594 41.0432V9.11745C38.0594 8.52337 37.8234 7.95369 37.4034 7.53354L30.5258 0.655961C30.1057 0.235984 29.5359 0 28.9419 0L8.8972 0Z" fill="#F5F5F5"/>\n                                    <path d="M37.4035 7.53367L32.8447 2.97485L32.8284 10.622C32.8274 11.102 33.2163 11.4918 33.6963 11.4918C34.1757 11.4918 34.5642 11.8804 34.5642 12.3597V41.0434C34.5642 42.6763 33.2404 44.0001 31.6074 44.0001H35.1027C36.7357 44.0001 38.0594 42.6763 38.0594 41.0434V12.1156V9.11749C38.0596 8.52341 37.8236 7.95373 37.4035 7.53367Z" fill="#EAEAEA"/>\n                                    <path d="M37.4033 7.5335L30.5257 0.655926C30.3342 0.464457 30.1114 0.311746 29.8696 0.20166V5.23279C29.8696 6.86577 31.1934 8.18955 32.8264 8.18955H37.8575C37.7475 7.94772 37.5948 7.72497 37.4033 7.5335Z" fill="#A8D0D5"/>\n                                    <path d="M16.3243 21.9575L15.7131 20.5742C15.3422 19.7349 14.511 19.1934 13.5934 19.1934H5.35361C4.07374 19.1934 3.03613 20.2309 3.03613 21.5108V41.6824C3.03613 42.9623 4.07366 43.9999 5.35361 43.9999H38.6467C39.9265 43.9999 40.9641 42.9624 40.9641 41.6824V25.6559C40.9641 24.376 39.9266 23.3384 38.6467 23.3384H18.4441C17.5264 23.3384 16.6952 22.7969 16.3243 21.9575Z" fill="#FFB541"/>\n                                    <path d="M12.187 20.5742L12.7982 21.9575C13.1691 22.7968 14.0003 23.3383 14.918 23.3383H18.444C17.5263 23.3382 16.6952 22.7968 16.3243 21.9575L15.7131 20.5742C15.3422 19.7349 14.511 19.1934 13.5934 19.1934H10.0674C10.985 19.1934 11.8161 19.7349 12.187 20.5742Z" fill="#FFA812"/>\n                                    <path d="M38.6468 23.3384H35.1209C36.4006 23.3385 37.4381 24.376 37.4381 25.6559V41.6825C37.4381 42.9624 36.4006 44 35.1206 44H38.6467C39.9266 44 40.9642 42.9625 40.9642 41.6825V25.6558C40.9643 24.3759 39.9267 23.3384 38.6468 23.3384Z" fill="#FFA812"/>\n                                    <path d="M16.6176 4.86731H10.0499C9.68309 4.86731 9.38574 4.56997 9.38574 4.20319C9.38574 3.83641 9.68309 3.53906 10.0499 3.53906H16.6176C16.9844 3.53906 17.2818 3.83641 17.2818 4.20319C17.2818 4.56997 16.9845 4.86731 16.6176 4.86731Z" fill="#3693BD"/>\n                                    <path d="M16.6176 8.86121H10.0499C9.68309 8.86121 9.38574 8.56387 9.38574 8.19708C9.38574 7.8303 9.68309 7.53296 10.0499 7.53296H16.6176C16.9844 7.53296 17.2818 7.8303 17.2818 8.19708C17.2818 8.56387 16.9845 8.86121 16.6176 8.86121Z" fill="#3693BD"/>\n                                </g>\n                                <defs>\n                                    <clipPath id="clip0_2698_2638">\n                                        <rect width="44" height="44" fill="white"/>\n                                    </clipPath>\n                                </defs>\n                            </svg>\n                            <p class="text-color-14 dark:text-white text-center font-medium font-Figtree text-20 mt-6">${jsLang("No subscribers found")}</p>\n                            <p class="text-center font-medium text-color-89 text-15 px-5 py-3 font-Figtree mt-3 md:w-[450px] mx-auto">${jsLang("Looks like you did not add any subscribers yet.")}</p>\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n    </section>\n    `}function initializeImportForm(){const e=$("#csvFileInput"),t=$("#fileNameDisplay"),n=$("#importBtn"),s=($("#importBtnText"),$("#importSubmitBtn")),o=$("#fileInfoDisplay"),a=$("#changeFileBtn");function i(){t.text(""),o.addClass("hidden"),n.removeClass("hidden"),s.addClass("hidden"),e.val("")}e.length&&(n.on("click",(function(t){t.preventDefault(),e.click()})),a.on("click",(function(t){t.preventDefault(),e.click()})),e.on("change",(function(a){const r=a.target.files[0];if(r){const a=r.name,d=a.split(".").pop().toLowerCase();if("csv"!==d&&"xlsx"!==d)return toastMixin.fire({icon:"error",title:jsLang("Please select a CSV or XLSX file only.")}),e.val(""),void i();t.text(a),o.removeClass("hidden"),n.addClass("hidden"),s.removeClass("hidden")}else i()})),$("#importForm").on("reset",(function(){setTimeout(i,100)})),$("#importForm").on("submit",(function(t){if(!e[0].files.length)return t.preventDefault(),toastMixin.fire({icon:"error",title:jsLang("Please select a CSV file first.")}),!1;s.prop("disabled",!0).html(`\n            <svg class="animate-spin w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">\n                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\n                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>\n            </svg>\n            <span>${jsLang("Importing...")}</span>\n        `)})))}$(document).ready((function(){void 0!==window.contactSessionSuccess&&window.contactSessionSuccess&&(toastMixin.fire({icon:"success",title:window.contactSessionSuccess}),setTimeout((function(){if("function"==typeof reloadContactsTable)reloadContactsTable();else if("function"==typeof searchContacts){const e=document.getElementById("searchContacts");e&&searchContacts(e)}}),1e3)),void 0!==window.contactSessionError&&window.contactSessionError&&toastMixin.fire({icon:"error",title:window.contactSessionError}),initializePhoneInput(),initializeImportForm(),$("#contactForm").on("submit",(function(e){e.preventDefault(),saveContact()})),$(document).on("click",'.openModalBtn[data-target="modal7"]',(function(e){e.preventDefault(),$("#contactForm")[0].reset(),$("#contactId").val(""),selectedSegments={},$(".segment-checkbox").prop("checked",!1),$("#selectedSegmentIds").val(""),$("#selectedSegmentsTags").addClass("hidden").empty(),$("#selectedCountBadge").addClass("hidden"),$('input[name="segment_ids[]"]').remove(),updateSelectedSegmentsDisplay(),$(".error-message").addClass("hidden").text(""),$(".border-red-500").removeClass("border-red-500"),phoneInput&&phoneInput.setNumber(""),$("#modal7 h5").text(jsLang("Contact Add")),$("#modal7 p").text(jsLang("Select Segment"));const t=$("#modal7");t.removeClass("hidden"),setTimeout((()=>{t.addClass("opacity-100"),t.find(".modalBox").addClass("scale-100 opacity-100")}),50)})),$(document).on("click",".closeModalBtn",(function(){const e=$(this).closest(".sweet-modal");e.length&&closeModal(e)})),$(document).on("click",'.openModalBtn[data-target^="deleteModal-"]',(function(e){e.preventDefault(),e.stopPropagation();const t=$(this).attr("data-target"),n=$(`#${t}`);n.length&&(n.removeClass("hidden"),setTimeout((()=>{n.addClass("opacity-100"),n.find(".modalBox").addClass("scale-100 opacity-100")}),10))})),$(document).on("click",".sweet-modal",(function(e){e.target===this&&closeModal($(this))})),$(document).on("submit",'form[id^="deleteContactForm-"]',(function(e){e.preventDefault();deleteContact(this.id.split("-")[1])}));let e=1,t=!1,n=!0,s="",o=null,a=!1;function i(s,o="",a=!1){if(t)return;t=!0,a?$("#segmentList").append(`<div class="px-4 py-2.5 text-sm text-gray-500 text-center" id="segmentLoadingMore">${jsLang("Loading more...")}</div>`):$("#segmentList").html(`<div class="px-4 py-2.5 text-sm text-gray-500 text-center">${jsLang("Loading...")}</div>`);const i=SITE_URL+"/user/marketing-bot/get-segments-dropdown";$.ajax({url:i,type:"GET",data:{page:s,search:o||""},dataType:"json",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},success:function(t){if($("#segmentLoadingMore").remove(),t.success)a||$("#segmentList").empty(),t.segments&&t.segments.length>0?t.segments.forEach((function(e){!function(e){const t=String(e.id),n=selectedSegments[t]?"checked":"";selectedSegments[t]&&selectedSegments[t].startsWith("Segment ")&&(selectedSegments[t]=e.name);const s=$("<div/>").text(e.name).html(),o=`\n            <div class="segment-option px-4 py-2.5 rounded-lg text-sm text-gray-700 dark:text-gray-200 hover:bg-color-F6 dark:hover:bg-color-3A cursor-pointer flex items-center gap-3 transition-colors duration-150"\n                data-id="${e.id}" data-name="${e.name}">\n                <div class="relative flex items-center">\n                    <input type="checkbox" class="segment-checkbox w-4 h-4 rounded border-color-DF dark:border-color-47 text-blue-600 focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-offset-0 cursor-pointer transition-all duration-150" value="${e.id}" data-name="${e.name}" ${n}>\n                </div>\n                <span class="flex-1 font-medium">${s}</span>\n            </div>\n        `;$("#segmentList").append(o),n&&updateSelectedSegmentsDisplay()}(e)})):a||$("#segmentList").html(`<div class="px-4 py-2.5 text-sm text-gray-500 text-center">${jsLang("No segments found")}</div>`),e=t.current_page,n=t.has_more_pages;else{const e=t.error||jsLang("Failed to load segments");a?$("#segmentLoadingMore").remove():$("#segmentList").html(`<div class="px-4 py-2.5 text-sm text-red-500 text-center">${e}</div>`)}},error:function(e,t,n){let s=jsLang("Error loading segments");e.responseJSON&&e.responseJSON.error?s=e.responseJSON.error:404===e.status?s=jsLang("Endpoint not found. Please check the route."):500===e.status?s=jsLang("Server error. Please try again."):0===e.status&&(s=jsLang("Network error. Please check your connection.")),a?$("#segmentLoadingMore").remove():$("#segmentList").html(`<div class="px-4 py-2.5 text-sm text-red-500 text-center">${s}</div>`)},complete:function(){t=!1}})}$("#segmentDropdownBtn").on("click",(function(e){e.stopPropagation();const t=$("#segmentDropdown").hasClass("hidden");$("#segmentDropdown").toggleClass("hidden"),t?$("#dropdownArrow").addClass("rotate-180"):$("#dropdownArrow").removeClass("rotate-180"),a||function(){if(a)return;const e=$(".segment-option").length;n=e>=e,a=!0}()})),$(document).on("change",".segment-checkbox",(function(e){e.stopPropagation();$(this).closest(".segment-option");const t=$(this).val(),n=$(this).data("name");$(this).is(":checked")?selectedSegments[t]=n:delete selectedSegments[t],updateSelectedSegmentsDisplay(),updateSegmentIdsInput()})),$(document).on("click",".segment-checkbox",(function(e){e.stopPropagation()})),$(document).on("click",".segment-option",(function(e){if($(e.target).is(".segment-checkbox"))return;const t=$(this).find(".segment-checkbox");t.prop("checked",!t.prop("checked")).trigger("change")})),$(document).on("click","#segmentDropdown",(function(e){e.stopPropagation()})),$(document).on("click",(function(e){$(e.target).closest("#segmentDropdownBtn, #segmentDropdown").length||$("#segmentDropdown").addClass("hidden")})),$("#segmentSearch").on("input",(function(){const t=$(this).val().trim();o&&clearTimeout(o),o=setTimeout((function(){s=t,e=1,i(1,t,!1)}),300)})),$("#segmentSearch").on("click",(function(e){e.stopPropagation()})),$("#segmentList").on("scroll",(function(){const o=$(this),a=o.scrollTop(),r=o[0].scrollHeight;if(a+o.height()>=r-50&&n&&!t){i(e+1,s,!0)}})),window.removeSegment=function(e){delete selectedSegments[e],$('.segment-checkbox[value="'+e+'"]').prop("checked",!1),updateSelectedSegmentsDisplay(),updateSegmentIdsInput()}})),window.loadContacts=function(){if("function"==typeof reloadContactsTable)reloadContactsTable();else if("function"==typeof searchContacts){const e=document.getElementById("searchContacts");e?searchContacts(e):"undefined"!=typeof contactRoute?window.location.href=contactRoute:window.location.reload()}else window.location.reload()},$(document).on("click",".openModalBtn",(function(){$(".delete-subscriber").attr("data-id",$(this).data("id"))})),$(document).on("click",".delete-subscriber",(function(){let e=$(this).attr("data-id");$(".loader").removeClass("hidden"),$(this).attr("disabled"),doAjaxprocess(SITE_URL+"/user/marketing-bot/subscriber/delete",{id:e,_token:CSRF_TOKEN},"delete","json").done((function(t,n,s){toastMixin.fire({title:t.message,icon:n}),$("#subscriber-row-"+e).remove();var o=$(".subscriber-table");0===o.find('[id^="subscriber-row-"]').length&&o.html(subscriberEmptyHtml()),$(".loader").addClass("hidden"),$(this).removeAttr("disabled"),$(".closeModalBtn").click()})).fail((function(e,t,n){toastMixin.fire({title:JSON.parse(e.responseText).error,icon:t}),$(".loader").addClass("hidden"),$(this).removeAttr("disabled"),$(".closeModalBtn").click()}))}));