"use strict";let debounceTimer;function filterTemplates(e,t){getMaterials(buildUrl({[t]:$(e).text().trim().toLowerCase()}))}function searchTemplates(e){getMaterials(buildUrl({search:$(e).val().trim().toLowerCase()}))}function getFilters(){return{channels:$(".custom-select .selected-option.filter-channel").text().trim().toLowerCase(),search:$("#template-search").val().trim().toLowerCase()}}function buildUrl(e={}){const t=search_route,n={...getFilters(),...e};return`${t}?${Object.entries(n).filter((([e,t])=>t&&"all"!==t)).map((([e,t])=>`${e}=${encodeURIComponent(t)}`)).join("&")}`}function getMaterials(e){clearTimeout(debounceTimer),debounceTimer=setTimeout((()=>{const t=$(".template-table");if(!t.length)return;const n=t.find(".table-skeleton"),a=t.find(".table-content");n.removeClass("hidden"),a.addClass("hidden"),$.ajax({url:e,type:"GET",data:{},dataType:"json",beforeSend:function(){$("#template-search").parent().find(".loader-icon").removeClass("hidden")},success:function(e){if($("#template-search").parent().find(".loader-icon").addClass("hidden"),e&&e.items){t.html(e.items);const n=t.find(".table-skeleton"),a=t.find(".table-content");n.addClass("hidden"),a.removeClass("hidden")}},error:function(){$("#template-search").parent().find(".loader-icon").addClass("hidden");const e=t.find(".table-skeleton"),n=t.find(".table-content");e.addClass("hidden"),n.removeClass("hidden")}})}),1e3)}$(document).on("click",".template-button",(function(e){e.preventDefault();const t=$(this).data("channel"),n=($(this).closest("form"),$(this));$.ajax({url:route,type:"POST",data:{channel:t,user_id:user_id,_token:CSRF_TOKEN},dataType:"JSON",beforeSend:function(){n.prop("disabled",!0).find(".loader-icon").removeClass("hidden"),window.templatesSkeleton&&window.templatesSkeleton.show&&window.templatesSkeleton.show()},success:function(e){$(".template-table").html(e.data),$(".template-table .table-content").removeClass("hidden"),window.templatesSkeleton&&window.templatesSkeleton.hide&&window.templatesSkeleton.hide(),toastMixin.fire({title:jsLang("Successfully Synced."),icon:"success"})},error:function(e){let t=e.responseJSON?.error||e.responseJSON?.message||jsLang("An error occurred");window.templatesSkeleton&&window.templatesSkeleton.hide&&window.templatesSkeleton.hide(),toastMixin.fire({title:t,icon:"error"})},complete:function(){n.prop("disabled",!1).find(".loader-icon").addClass("hidden")}})})),$(document).on("click",".openModalBtn",(function(){$(".delete-template").attr("data-id",$(this).data("id")),$(".delete-template").attr("data-channel",$(this).data("channel"))})),$(document).on("click",".delete-template",(function(e){let t=$(this).attr("data-id"),n=$(this).data("channel");$(".loader").removeClass("hidden"),$(this).attr("disabled"),doAjaxprocess(SITE_URL+"/user/marketing-bot/templates/delete/"+t,{user_id:user_id,channel:n,_token:CSRF_TOKEN},"delete","json").done((function(e,n,a){toastMixin.fire({title:e.message,icon:n}),$("#template-row-"+t).remove(),$(".loader").addClass("hidden"),$(this).removeAttr("disabled"),$(".closeModalBtn").click()})).fail((function(e,t,n){toastMixin.fire({title:JSON.parse(e.responseText).error,icon:t}),$(".loader").addClass("hidden"),$(this).removeAttr("disabled"),$(".closeModalBtn").click()}))}));