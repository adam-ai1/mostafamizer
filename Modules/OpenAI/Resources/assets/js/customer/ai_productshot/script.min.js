let debounceTimer;$(".product-type-dropdown").on("click",(function(e){e.stopPropagation(),$(".product-dropdown-content").slideToggle(200)})),$(document).on("click",(function(){$(".product-dropdown-content").hide()}));var spinner='\n    <div class="avatar-card flex flex-col gap-2 items-center justify-center rounded cursor-pointer hover:bg-[#f3f3f3] dark:hover:bg-color-43 p-2 fetch-skeleton">\n        <div class="skeleton-loader w-full h-[92px] rounded"></div>\n        <div class="skeleton-loader w-full h-[22px] rounded mt-2"></div>\n    </div>\n';function debouncedSearch(e,t){clearTimeout(debounceTimer),debounceTimer=setTimeout((()=>{searchItems(e,t)}),500)}function searchItems(e,t){const a=$(e).val().toLowerCase(),n=$(t);n.empty();for(let e=0;e<4;e++)n.append(spinner);doAjaxprocess(SITE_URL+"/user/ai-product-photography?name="+a.trim(),{},"get","json").done((function(e){n.empty(),pageNumber=0;const t=e.items.data;renderSidebarAndOptions(n,t),0===t.length&&n.append(`<p class="flex items-center justify-center col-span-2 h-40 text-center text-color-14 dark:text-white text-16 font-normal font-Figtree">${jsLang("No data found.")} </p>`);0===(pageNumber=e.nextPageUrl?e.nextPageUrl.split("?page=")[1]:0)&&$(".background-container").data("next-page-url","")}))}var pageNumber=0,checked=!0;function checkScrollIfAtEnd(e,t){var a=e.scrollHeight,n=e.clientHeight,r=e.scrollTop,o=".background-container";if(0==pageNumber&&null!==pageNumber&&(pageNumber=$(o).data("next-page-url")?$(o).data("next-page-url").split("?page=")[1]:0),r+n>=a&&pageNumber&&0!=pageNumber&&0!=pageNumber.length&&checked){checked=!1;const e=$(t),a=e.children().length,n=Math.ceil(a/2)%2==0?4:5;for(let t=0;t<n;t++)e.append(spinner);doAjaxprocess(SITE_URL+"/user/ai-product-photography?page="+pageNumber,{},"get","json").done((function(t){const a=t.items.data;renderSidebarAndOptions(e,a),$(".fetch-skeleton").remove(),pageNumber=t.nextPageUrl?t.nextPageUrl.split("?page=")[1]:null,checked=!0}))}}function renderSidebarAndOptions(e,t){let a="";t.forEach((e=>{a+=`\n            <div class="avatar-card flex flex-col gap-2 items-center justify-center rounded cursor-pointer hover:bg-[#f3f3f3] dark:hover:bg-color-43 p-2" \n                data-name="${e.name}" data-id="${e.background_id}" data-image="${e.file_url}"\n                onclick="selectBackground(this)">\n                <img class="object-cover rounded w-full h-[92px]" src="${e.file_url}" alt="${jsLang("Image")}">\n                <p class="dark:text-white font-medium text-[15px] p-1 leading-[22px] font-Figtree wrap-anywhere text-left line-clamp-single dept-name avatar-name">\n                    ${e.name}\n                </p>\n            </div>\n        `})),e.append(a),e.removeAttr("data-next-page-url")}function selectBackground(e){const t=$("#background"),a=$(".background-information .background-name"),n=$(".background-image"),r=$(e).data("id"),o=$(e).data("name"),d=$(e).data("image");if($(e).hasClass("avatar-border-active"))return t.val(""),a.text(`${jsLang("All Backgrounds")}`),n.attr("src","").addClass("hidden"),void $(e).removeClass("avatar-border-active");t.val(r),a.text(o),n.attr("src",d).removeClass("hidden"),$(".avatar-border-active").removeClass("avatar-border-active"),$(e).addClass("avatar-border-active")}$(".background-container").on("scroll",(function(){checkScrollIfAtEnd(this,".background-list")})),$(document).on("submit","#productshot-form",(function(e){e.preventDefault();let t=!0;if($("[data-field]").find("input, textarea, select").each((function(){$(this).removeAttr("required")})),$("[data-field]").each((function(){$(this).is(":visible")&&$(this).find("input, textarea, select").not(".search-input").prop("required",!0)})),$("[data-field]").find("input, textarea, select").each((function(){if($(this).is(":visible")&&!$(this)[0].checkValidity())return $(this)[0].reportValidity(),t=!1,!1})),!t)return!1;const a=new FormData,n=$("#provider").val();$(this).serializeArray().forEach((function(e){let t=e.name.trim();if(["prompt","provider"].includes(t))a.append(t,e.value);else if(t.startsWith(`${n}[`)){const n=t.match(/\[(.*?)\]/)[1];a.append(`options[${n}]`,e.value)}})),a.append("options[file]",$("#file_input")[0].files[0]),$('input[name="'+n+'_file"]').each((function(){const e=$(this).data("name"),t=$(this).prop("files");t&&t.length>0&&Array.from(t).forEach((t=>a.append(`options[${e}]`,t)))})),$("#background").val()&&a.append("options[background_id]",$("#background").val()),$.ajax({headers:{"X-CSRF-TOKEN":CSRF_TOKEN},url:PROMPT_URL,type:"POST",beforeSend:function(e){$(".loader-video").removeClass("hidden"),$("#product-shot-creation").attr("disabled","disabled"),e.setRequestHeader("Authorization","Bearer "+ACCESS_TOKEN)},data:a,contentType:!1,cache:!1,processData:!1,success:function(e){if(e.message)return errorMessage(e.message,"product-shot-creation"),!0;$("#productshot-form .loader").addClass("hidden");let t=$(".productshot-image-left");isNaN(t.text())||null==e.data.images||"subscription"!=e.data.balance_reduce_type||t.text(t.text()-e.data.images.length);var a="";a+='<div class="flex flex-wrap justify-center items-center md:gap-6 gap-5 mt-10 image-content1 9xl:mx-32 3xl:mx-16 2xl:mx-5">',$.each(e.data.images,(function(t,n){a+='<div class="relative md:w-[300px] md:h-[300px] w-[181px] h-[181px] download-image-container md:rounded-xl rounded-lg">',a+='<img class="m-auto md:w-[300px] md:h-[300px] w-[181px] h-[181px] cursor-pointer md:rounded-xl rounded-lg border border-color-DF dark:border-color-3A object-cover"src="'+n.url+'" alt=""><div class="image-hover-overlay"></div>',a+='<div class=" flex gap-3 right-3 bottom-3 absolute">',a+='<div class="image-download-button"><a class="relative tooltips w-9 h-9 flex items-center m-auto justify-center" href="'+n.slug_url+'">',a+=`<img class="w-[18px] h-[18px]" src="${SITE_URL}/Modules/OpenAI/Resources/assets/image/view-eye.svg" alt="">`,a+='<span class="image-download-tooltip-text z-50 w-max text-white items-center font-medium text-12 rounded-lg px-2.5 py-[7px] absolute z-1 top-[138%] left-[50%] ml-[-22px]">View</span>',a+="</a>",a+="</div>",a+='<div class="image-download-button"><a class="file-need-download relative tooltips w-9 h-9 flex items-center m-auto justify-center" href="'+n.url+'" download="'+filterXSS(e.data.title)+'" Downlaod>',a+=`<img class="w-[18px] h-[18px]" src="${SITE_URL}/Modules/OpenAI/Resources/assets/image/file-download.svg" alt="">`,a+='<span class="image-download-tooltip-text z-50 w-max text-white items-center font-medium text-12 rounded-lg px-2.5 py-[7px] absolute z-1 top-[138%] left-[50%] ml-[-38px]">Download</span>',a+="</a>",a+="</div>",a+="</div>",a+="</div>"})),a+="</div>",$("#productshot-gallery").prepend(a),$(".loader").addClass("hidden"),$("#image-creation").removeAttr("disabled"),toastMixin.fire({title:jsLang("Image generated successfully."),icon:"success"})},complete:()=>{$(".loader-video").addClass("hidden"),$("#product-shot-creation").removeAttr("disabled")},error:function(e){let t;try{t=JSON.parse(e.responseText)}catch(e){return errorMessage(jsLang("Invalid server response"),"product-shot-creation"),!0}const a=t?.error||t?.message||0===t?.records?.length&&t?.response?.status?.message||t?.data?.response||t?.response?.status?.message;if(a)return errorMessage(a,"product-shot-creation"),!0}})}));let attrValue,activeProvider=$("#provider option:selected").val(),model=$("select[name='"+activeProvider+"[model]'] option:selected").val(),dataAttrValues={};function hideProviderOptions(){$(".ProviderOptions").each((function(){$(this).addClass("hidden")}))}function updateDataAttr(){for(let e in dataAttrValues)if(dataAttrValues.hasOwnProperty(e)){let t=dataAttrValues[e],a=$('[data-attr="'+t+'"]');model===t?(a.removeClass("hidden"),a.each((function(){$(this).find("select").length>0&&$(this).find("select option").length<=1&&$(this).addClass("hidden")}))):a.addClass("hidden")}}function storeAttrObject(){$("[data-attr]").each((function(){attrValue=$(this).data("attr"),dataAttrValues[$(this).attr("data-attr")]=attrValue}))}function clear(){const e=$("#background").closest("[data-field='background']");e.is(":hidden")&&(e.show(),$("#background").attr("required",!0)),e.show(),$(".AdavanceOption").removeClass("hidden")}function handleServiceClassChange(e){updateDataAttr();const t=e.find("option:selected"),a=t.length?t.data():{};$.each(a,(function(e,t){const a=Boolean(t),n=$(`.${activeProvider}_div [data-field="${e}"]`).length?$(`.${activeProvider}_div [data-field="${e}"]`):$(`[data-field="${e}"]`);if(n.length)n.toggleClass("hidden",!a),n.removeAttr("style"),n.find("input, textarea, select").not(".search-input").prop("required",a);else{const t=`${activeProvider}[${e}]`,n=void 0!==model?`select[name='${t}[${model}]'], select[name='${t}']`:`select[name='${t}']`,r=document.querySelectorAll(`input[name='${t}[${model}]'], input[name='${t}']`),o=document.querySelectorAll(`textarea[name='${t}'], textarea[name='${t}[${model}]']`),d=(e,t)=>{e&&0!==e.length&&(e.length?Array.from(e):[e]).forEach((e=>{$(e.parentElement).attr("hidden",t?null:"hidden"),e.parentElement.classList.toggle("hidden",!t)}))};d(document.querySelectorAll(n),a),d(r.length>0?r:null,a),d(o.length>0?o:null,a)}})),hideSingleData()}function hideSingleData(){let e=$("."+activeProvider+"_div").children();e.each((function(){let e=$(this);e.data("field")||e.find("select").length>0&&e.find("select option").length<=1&&e.addClass("hidden")})),e.length===e.filter(".hidden").length&&$(".AdavanceOption").addClass("hidden")}$(".AdavanceOption").on("click",(function(){if("hidden"==$("#ProviderOptionDiv").attr("class")){hideProviderOptions();let e=$("#provider option:selected").val();$("."+e+"_div").removeClass("hidden"),$("#ProviderOptionDiv").removeClass("hidden")}else $("#ProviderOptionDiv").addClass("hidden")})),$("#provider").on("change",(function(){clear(),hideProviderOptions(),activeProvider=$(this).val(),$("."+activeProvider+"_div").removeClass("hidden"),model=$("select[name='"+activeProvider+"[model]'] option:selected").val(),storeAttrObject(),handleServiceClassChange($(`.custom-dropdown-arrow[data-attr="${model}"]`).find("select.service-class")),hideSingleData()})),$(document).ready((function(){$("#provider").trigger("change")})),$(document).on("change",".model-class",(function(){model=$(this).val(),handleServiceClassChange($(`.custom-dropdown-arrow[data-attr="${model}"]`).find("select.service-class"))})),$(document).on("change",".service-class",(function(){handleServiceClassChange($(this))}));